{"is_source_file": true, "format": "JavaScript", "description": "This file defines an Express middleware named 'auditLogger' that logs API actions to an 'audit_logs' database table. It captures user actions, resource details, request metadata, and sanitizes sensitive information before logging.", "external_files": ["uuid"], "external_methods": ["require('uuid').v4", "console.error"], "published": ["auditLogger"], "classes": [], "methods": [{"name": "auditLogger", "description": "Middleware function that intercepts responses to log API actions and metadata, excluding certain paths like health checks."}, {"name": "extractResourceType(path)", "description": "Helper function to parse the resource type from request path.", "scope": "", "scopeKind": ""}, {"name": "extractResourceId(data)", "description": "Helper function to parse resource ID from response data.", "scope": "", "scopeKind": ""}, {"name": "sanitizeBody(body)", "description": "Helper function to sanitize request body data by redacting sensitive fields.", "scope": "", "scopeKind": ""}, {"name": "send(data)", "scope": "res", "scopeKind": "function", "description": "unavailable"}], "calls": ["require('uuid').v4", "pool.query", "console.error"], "search-terms": ["auditLogger middleware", "resourceType extraction", "sensitive data sanitization", "audit_log insertion", "API audit logging"], "state": 2, "file_id": 33, "knowledge_revision": 83, "git_revision": "85b189065008d26a55883aaacacc5cd9e3c4167c", "ctags": [{"_type": "tag", "name": "action", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        action: action,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "auditData", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^      const auditData = {$/", "language": "JavaScript", "kind": "class", "scope": "res.send", "scopeKind": "class"}, {"_type": "tag", "name": "auditLogger", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^const auditLogger = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "auditLogger", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^module.exports = { auditLogger };$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^          body: sanitizeBody(req.body),$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData.details", "scopeKind": "class"}, {"_type": "tag", "name": "details", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        details: {$/", "language": "JavaScript", "kind": "class", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "extractResourceId", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^function extractResourceId(data) {$/", "language": "JavaScript", "kind": "function", "signature": "(data)"}, {"_type": "tag", "name": "extractResourceType", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^function extractResourceType(path) {$/", "language": "JavaScript", "kind": "function", "signature": "(path)"}, {"_type": "tag", "name": "ip_address", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        ip_address: req.ip || req.connection.remoteAddress,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "method", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^          method: req.method,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData.details", "scopeKind": "class"}, {"_type": "tag", "name": "originalSend", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^  const originalSend = res.send;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^          path: req.path,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData.details", "scopeKind": "class"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^          query: req.query,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData.details", "scopeKind": "class"}, {"_type": "tag", "name": "resource_id", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        resource_id: resourceId,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "resource_type", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        resource_type: resourceType,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "sanitizeBody", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^function sanitizeBody(body) {$/", "language": "JavaScript", "kind": "function", "signature": "(body)"}, {"_type": "tag", "name": "send", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^  res.send = function(data) {$/", "language": "JavaScript", "kind": "function", "signature": "(data)", "scope": "res", "scopeKind": "function"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^          status: res.statusCode$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData.details", "scopeKind": "class"}, {"_type": "tag", "name": "tenant_id", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        tenant_id: req.user.tenant_id,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "user_agent", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        user_agent: req.headers['user-agent']$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/device-remote-management-581-705/BackendContainer/src/middleware/auditLogger.js", "pattern": "/^        user_id: req.user.id,$/", "language": "JavaScript", "kind": "property", "scope": "res.send.auditData", "scopeKind": "class"}], "hash": "70375ccc57c6610a1a4361fbe59d09c0", "format-version": 4, "code-base-name": "DatabaseContainer", "filename": "BackendContainer/src/middleware/auditLogger.js", "fields": [{"name": "action: action,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "module.exports = { auditLogger };", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "body: sanitizeBody(req.body),", "scope": "res.send.auditData.details", "scopeKind": "class", "description": "unavailable"}, {"name": "ip_address: req.ip || req.connection.remoteAddress,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "method: req.method,", "scope": "res.send.auditData.details", "scopeKind": "class", "description": "unavailable"}, {"name": "path: req.path,", "scope": "res.send.auditData.details", "scopeKind": "class", "description": "unavailable"}, {"name": "query: req.query,", "scope": "res.send.auditData.details", "scopeKind": "class", "description": "unavailable"}, {"name": "resource_id: resourceId,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "resource_type: resourceType,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "status: res.statusCode", "scope": "res.send.auditData.details", "scopeKind": "class", "description": "unavailable"}, {"name": "tenant_id: req.user.tenant_id,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "user_agent: req.headers['user-agent']", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}, {"name": "user_id: req.user.id,", "scope": "res.send.auditData", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"83": "85b189065008d26a55883aaacacc5cd9e3c4167c"}]}